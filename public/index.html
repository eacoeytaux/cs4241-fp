
<!DOCTYPE html>
<html lang="en">
<head>
	<title>CS4241 Final Project</title>
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="css/style.css"/>
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Arvo">
	<link href="https://fonts.googleapis.com/css?family=Ubuntu+Condensed" rel="stylesheet"> 
	<!-- polyfill -->
	<script src="midi/inc/shim/Base64.js" type="text/javascript"></script>
	<script src="midi/inc/shim/Base64binary.js" type="text/javascript"></script>
	<script src="midi/inc/shim/WebAudioAPI.js" type="text/javascript"></script>
	<!-- midi.js package -->
	<script src="midi/js/midi/audioDetect.js" type="text/javascript"></script>
	<script src="midi/js/midi/gm.js" type="text/javascript"></script>
	<script src="midi/js/midi/loader.js" type="text/javascript"></script>
	<script src="midi/js/midi/plugin.audiotag.js" type="text/javascript"></script>
	<script src="midi/js/midi/plugin.webaudio.js" type="text/javascript"></script>
	<script src="midi/js/midi/plugin.webmidi.js" type="text/javascript"></script>
	<!-- utils -->
	<script src="midi/js/util/dom_request_xhr.js" type="text/javascript"></script>
	<script src="midi/js/util/dom_request_script.js" type="text/javascript"></script>
</head>
<body>
	<div class="header">
		<h1 id="mainHeading"><img id="trexImg" src="images/trex2.png" alt="T-Rex Logo">maTRex</h1>
		<h3>Just the musical matrix that you are looking for!</h3>
	</div>
	<div class="content"></div>
</body>

<script>

// order goes [row][column]
noteArray = [[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];

var height = 16;
var width = 16;
var currCol = 0;
var currColor = "#C05B73";
var beatsPerMin = 100;
var mouseClick = false;
var addColor = false;
var key = 'C';
var instrument = "honkytonk_piano";

var intervalVar = window.setInterval(highlightCol, beatsPerMin); // repeat forever, polling every 100 ms

var baseNote = 86;
var offset = 0;

// stores the global list of all songs
var songList = []

function loadMIDI(instrumentName, cb) {
	MIDI.loadPlugin({
		soundfontUrl: "./soundfont/",
		instrument: instrumentName,
		onprogress: function(state, progress) {
			console.log(state, progress);
		},
		onsuccess: function() {
			MIDI.programChange(0, MIDI.GM.byName[instrumentName].number);
			if (cb) cb();
		}
	});
}

// Add event listeners to notes
window.onload = function() {

	makeGet('/search-song?', function(data) {
		noteArray = data.songs[0].matrix;
		height = noteArray.length;
		width = noteArray[0].length;
		//beatsPerMin = data.songs[0].bpm;
		//key = data.songs[0].key;
		//instrument = data.songs[0].instrument;

		loadMIDI(instrument);
		loadHTML();
		loadMatrix();
	});

	// mouse release event anywhere in the document disables mouse click
	document.addEventListener("mouseup", function(evt) {
		mouseClick = false;
	});
}

function loadMatrix(song) {

	el = document.getElementById("matrix");
		//el.style.width = (40 * width) + "px";
		html = '<center>';

		// Add the correct number of notes to the matrix
		for(var row = 0; row < height; row++) {

			html = html + '<div class="row" draggable=false>';
			for(var col = 0; col < width; col++) {
				html = html + '<div id="' + row + ':' + col +'" class="notes row:' + row + ' col:' + col + '" draggable=false></div>';
			}
			html = html + '</div>';
		}
		el.innerHTML = html + '</center>';
		
		
		for(var row = 0; row < height; row++) {
			for(var col = 0; col < width; col++) {
				if(noteArray[row][col] == 1) {
					document.getElementById(row+ ':' + col).style.backgroundColor = '#F0F0F0';
				}
				else {
					document.getElementById(row+ ':' + col).style.backgroundColor = '#494949';
				}
			}
		}
		
		
		var notes = document.getElementsByClassName("notes");
		for (var i = 0; i < notes.length; i++) {
			notes[i].addEventListener("mousedown", function(evt) {

				// set the mouse click boolean to true
				mouseClick = true;
				// determine the row and column of the clicked noteArray
				var temp = evt.target.className.split(':')
				var row = temp[1].split(' ')[0];
				var col = temp[2];
				if(noteArray[row][col] == 0) {
					evt.target.style.backgroundColor = '#F0F0F0';
					noteArray[row][col] = 1;
					addColor = true;
				}
				else {
					evt.target.style.backgroundColor = '#494949';
					noteArray[row][col] = 0;
					addColor = false;
				}
			});
		}
		
		
		// handle mouse drag events
		for (var i = 0; i < notes.length; i++) {
			notes[i].addEventListener("mouseover", function(evt) {

				// change the note color if a mouse click has already occured
				if(mouseClick) {

					// determine the row and column of the clicked noteArray
					var temp = evt.target.className.split(':')
					var row = temp[1].split(' ')[0];
					var col = temp[2];
					if(addColor) {
						evt.target.style.backgroundColor = '#F0F0F0';
						noteArray[row][col] = 1;
					}
					else {
						evt.target.style.backgroundColor = '#494949';
						noteArray[row][col] = 0;
					}
				}
			});
		}

		clearInterval(intervalVar);
		intervalVar = window.setInterval(highlightCol, beatsPerMin);
	}


function highlightCol() {

	// Make any active cells white again
	var el; 
	for(var row = 0; row < height; row++) {
		if(noteArray[row][currCol]) {
			el = document.getElementById(row+ ':' + currCol);
			el.style.backgroundColor = '#F0F0F0';

			MIDI.noteOff(0, getNoteVal(row, baseNote + offset), 0.75);
		}
	}

	// increment the currCol variable
	if(currCol < (width-1)) {
		currCol += 1;
	}
	else {
		currCol = 0;
	}

	// determine which notes are active
	for(var row = 0; row < height; row++) {
		if(noteArray[row][currCol]) {
			el = document.getElementById(row+ ':' + currCol)
			el.style.backgroundColor = currColor;

			MIDI.noteOn(0, getNoteVal(row, baseNote + offset), 127, 0);
		}
	}
}

var pentatonicScale = [10, 8, 5, 3, 0];
function getNoteVal(col, offset) {
	var octave = Math.floor(col / 5) + 2;
	var noteVal = pentatonicScale[(col % 5)] - (octave * 12) + offset;
	return noteVal;
}

// add a column to the matrix
function addCol() {

	if(width < 16) {
		for(var row = 0; row < height; row++) {
			noteArray[row].push(0)
		}
		width += 1;
		loadMatrix();
	}
}

// remove a column from the matrix
function removeCol() {

	if(width > 0) {
		for(var row = 0; row < height; row++) {
			noteArray[row].splice(noteArray[row].length-1,noteArray[row].length)
		}
		width -= 1;
		loadMatrix();
	}
}

// add a row to the matrix
function addRow() {

	if(height < 16) {
		var newRow = []
		for(var col = 0; col < width; col++) {
			newRow.push(0);
		}
		noteArray.splice(0,0,newRow);
		height += 1;
		loadMatrix();
	}
}

// remove a row from the matrix
function removeRow() {
	
	if(height > 0) {
		noteArray.splice(0,1)
		height -= 1;
		loadMatrix();
	}
}


// function to handle saving of the current matrix
function save() {
	console.log("save");

	var song = {};

	/* Make sure that the song has an artist and title */
	if((document.getElementById("titleInput").value == "") || (document.getElementById("authorInput").value) == "") {
		alert("You must add a song title and artist name to save.")
	}
	else {

		song.name = document.getElementById("titleInput").value;
		song.artist = document.getElementById("authorInput").value;
		song.matrix = noteArray;
		song.height = noteArray.length;
		song.width = noteArray[0].length;
		song.comment = document.getElementById("descInput").value;
		song.color = document.getElementById("colorPicker").value;

		console.log("song data", song);
		makePost('add-song', JSON.stringify(song));
		
		loadHome();

	}
}

function back() {
	if (confirm("Just a head's up, you will lose any unsaved progress!") == true) {
		loadHome();
	} else {
	} 
}

function searchArtist(songID) {

	// get the name of the artist
	var artistName = '/search-artist?' + songList[songID].artist;
	console.log(artistName);

	makeGet(artistName, function(data) {
		
		clearInterval(intervalVar);
		/* Get the current song list */
		songList = data.songs;
		console.log("data: ", data); 
		loadHomeHTML();
	});
}

function refresh() {
	loadHome();
}

// loads the home page
function loadHome() {

	clearInterval(intervalVar);

	/* Get the current song list */
	makeGet('/search-song?', function(data) {
		songList = data.songs;
		loadHomeHTML();
	});
}

function sortSongs() {
	songList = songList.sort(function(a, b) {
		switch (document.getElementById("sortType").value) {
			case 'recent':
			if (a.date < b.date) {
				return -1;
			} else if (a.date > b.date) {
				return 1;
			} else {
				return 0;
			}
			break;
			case 'popular':
			if (a.likes < b.likes) {
				return -1;
			} else if (a.likes > b.likes) {
				return 1;
			} else {
				return 0;
			}
			break;
			case 'alphabetical':
			if (a.name < b.name) {
				return -1;
			} else if (a.name > b.name) {
				return 1;
			} else {
				return 0;
			}
			break;
		}
	});

	loadSongs();
}

function search() {

	var cb = function(data) {
		songList = data.songs;

		sortSongs();
	}

	var input = document.getElementById("searchText").value;
	switch (document.getElementById("searchType").value) {
		case 'song':
		makeGet('/search-song?' + input, cb);
		break;
		case 'artist':
		makeGet('/search-artist?' + input, cb);
		break;
	}
}

function loadHomeHTML() {

	/* html string to store new html to load */
	html = '<div id="searchArea"><center>';

	html += '<span>';
	html += 'Search by: <select id="searchType"><option value="song">Song</option><option value="artist">Artist</option></select>';
	html += '</span>';

	html += '<span id="searchBar">';
	html += '<input type="text" id="searchText" placeholder="Search">';
	html += '<button id="searchButton" onclick="search();">Search</button>';
	html += '</span>';

	html += '<span>';
	html += 'Sort by: <select id="sortType"><option value="recent">Recent</option><option value="popular">Popular</option><option value="alphabetical">Alphabetical</option></select>';
	html += '</span>';

	html += '</center></div>';

	html += "<div id=\"songList\"></div>";
	html += "<center><div class='tool'><button type='button' id='refreshBtn' onClick='refresh()'>Refresh</button></div></center>"
	document.getElementsByClassName("content")[0].innerHTML = html;

	document.getElementById("sortType").addEventListener("change", sortSongs);

	loadSongs();
}

function loadSongs() {
	var html = '';

	for(var song = 0; song < songList.length; song++) {

		console.log(songList[song].name);
		console.log(songList[song].color);
		var colorString;
		if(songList[song].color) {
			console.log("color defined")
		}
		html += "<div class='song' ><div class='songMatrix' id='" + song + "' onClick='loadSong(this.id)'>";

    	// only show 8x8 of the matrix if it is larger than 8x8
    	var tempHeight = songList[song].height;
    	var tempWidth = songList[song].width
    	if(tempHeight > 8) {
    		tempHeight = 8;
    	}
    	if(tempWidth > 8) {
    		tempWidth = 8;
    	}

    	// Add the correct number of notes to the matrix
    	for(var row = 0; row < tempHeight; row++) {

    		html += '<div class="smallRow">';
    		for(var col = 0; col < tempWidth; col++) {
				// determine if that square is highlighted of not
				if(songList[song].matrix[row][col]) {
					colorString = '#F0F0F0';
				}
				else {
					colorString = '#494949';
				}
				html += '<div class="smallNote" style="background-color: ' + colorString + ';"></div>';
			}
			html += '</div>';
		}

		html += "</div><div class='songInfo'><span class='songTitle' id='" + song + "' onClick='loadSong(this.id)'>" 
		html += songList[song].name;
		html += "</span></br><span class='songArtist' id='" + song + "' onClick='searchArtist(this.id)'>";
		html += songList[song].artist + "</span></br></br><span class='songComment' id='" 
		html += song + "' onClick='loadSong(this.id)'>";
		html += songList[song].comment + "</span>" + "</div><div class='songButton'>";
		html += '<button type="button" id="' + song + '" onClick="likeButton(this.id)">Like</button>';
		html += '<span class="songTitle">' + songList[song].likes + '</span>';
 		html += '<button type="button" id="' + song + '" onClick="unlikeButton(this.id)">Unlike</button></div></div><hr>';

	}

	document.getElementById("songList").innerHTML = html;
}


function loadHTML() {

	var html = '<div id="buffer" class="side-panel"></div>';
	html +='<div id="matrix" draggable=false>'
	html += '</div>'
	html += '<div id="tools" class="side-panel">'
	html += '<div class="tool">'
	html += '<button type="button" id="addCol" onClick="addCol()">Add Column</button>'
	html += '<button type="button" id="removeCol" onClick="removeCol()">Remove Column</button>'
	html += '</div>'
	html += '<div class="tool">'
	html += '<button type="button" id="addRow" onClick="addRow()">Add Row</button>'
	html += '<button type="button" id="removeRow" onClick="removeRow()">Remove Row</button>'
	html += '</div>'
	html += '<div class="tool">'
	html += '<input type="text" id="tempoInput" placeholder="BPM" value="100">BPM'
	html += '</div>'
	html += '<div class="tool">'
	html += '<select id="instrumentInput">'
	html += '<option value="accordion">Accordion</option>'
	html += '<option value="acoustic_bass">Acoustic Bass</option>'
	html += '<option value="acoustic_grand_piano">Acoustic Grand Piano</option>'
	html += '<option value="acoustic_guitar_nylon">Acoustic Guitar Nylon</option>'
	html += '<option value="acoustic_guitar_steel">Acoustic Guitar Steel</option>'
	html += '<option value="agogo">Agogo</option>'
	html += '<option value="alto_sax">Alto Sax</option>'
	html += '<option value="applause">Applause</option>'
	html += '<option value="banjo">Banjo</option>'
	html += '<option value="baritone_sax">Baritone Sax</option>'
	html += '<option value="bassoon">Bassoon</option>'
	html += '<option value="bird_tweet">Bird Tweet</option>'
	html += '<option value="blown_bottle">Blown Bottle'
	html += '<option value="brass_section">Brass Section</option>'
	html += '<option value="breath_noise">Breath Noise</option>'
	html += '<option value="bright_acoustic_piano">Bright Acoustic Piano</option>'
	html += '<option value="celesta">Celesta</option>'
	html += '<option value="cello">Cello</option>'
	html += '<option value="choir_aahs">Choir Aahs</option>'
	html += '<option value="church_organ">Church Organ</option>'
	html += '<option value="clarinet">Clarinet</option>'
	html += '<option value="clavichord">Clavichord</option>'
	html += '<option value="contrabass">Contrabass</option>'
	html += '<option value="distortion_guitar">Distortion Guitar</option>'
	html += '<option value="drawbar_organ">Drawbar Organ</option>'
	html += '<option value="dulcimer">Dulcimer</option>'
	html += '<option value="electric_bass_finger">Electric Bass Finger</option>'
	html += '<option value="electric_bass_pick">Electric Bass Pick</option>'
	html += '<option value="electric_grand_piano">Electric Grand Piano</option>'
	html += '<option value="electric_guitar_clean">Electric Guitar Clean</option>'
	html += '<option value="electric_guitar_jazz">Electric Guitar Jazz</option>'
	html += '<option value="electric_guitar_muted">Electric Guitar Muted</option>'
	html += '<option value="electric_piano_1">Electric Piano 1</option>'
	html += '<option value="electric_piano_2">Electric Piano 2</option>'
	html += '<option value="english_horn">English Horn</option>'
	html += '<option value="fiddle">Fiddle</option>'
	html += '<option value="flute">Flute</option>'
	html += '<option value="french_horn">French Horn</option>'
	html += '<option value="fretless_bass">Fretless Bass</option>'
	html += '<option value="fx_1_rain">Fx 1 Rain</option>'
	html += '<option value="fx_2_soundtrack">Fx 2 Soundtrack</option>'
	html += '<option value="fx_3_crystal">Fx 3 Crystal</option>'
	html += '<option value="fx_4_atmosphere">Fx 4 Atmosphere</option>'
	html += '<option value="fx_5_brightness">Fx 5 Brightness</option>'
	html += '<option value="fx_6_goblins">Fx 6 Goblins</option>'
	html += '<option value="fx_7_echoes">Fx 7 Echoes</option>'
	html += '<option value="fx_8_scifi">Fx 8 Scifi</option>'
	html += '<option value="glockenspiel">Glockenspiel</option>'
	html += '<option value="guitar_fret_noise">Guitar Fret Noise</option>'
	html += '<option value="guitar_harmonics">Guitar Harmonics</option>'
	html += '<option value="gunshot">Gunshot</option>'
	html += '<option value="harmonica">Harmonica</option>'
	html += '<option value="harpsichord">Harpsichord</option>'
	html += '<option value="helicopter">Helicopter</option>'
	html += '<option selected="selected" value="honkytonk_piano">Honkytonk Piano</option>'
	html += '<option value="kalimba">Kalimba</option>'
	html += '<option value="koto">Koto</option>'
	html += '<option value="lead_1_square">Lead 1 Square</option>'
	html += '<option value="lead_2_sawtooth">Lead 2 Sawtooth</option>'
	html += '<option value="lead_3_calliope">Lead 3 Calliope</option>'
	html += '<option value="lead_4_chiff">Lead 4 Chiff</option>'
	html += '<option value="lead_5_charang">Lead 5 Charang</option>'
	html += '<option value="lead_6_voice">Lead 6 Voice</option>'
	html += '<option value="lead_7_fifths">Lead 7 Fifths</option>'
	html += '<option value="lead_8_bass_lead">Lead 8 Bass Lead</option>'
	html += '<option value="marimba">Marimba</option>'
	html += '<option value="melodic_tom">Melodic Tom</option>'
	html += '<option value="music_box">Music Box</option>'
	html += '<option value="muted_trumpet">Muted Trumpet</option>'
	html += '<option value="oboe">Oboe</option>'
	html += '<option value="ocarina">Ocarina</option>'
	html += '<option value="orchestra_hit">Orchestra Hit</option>'
	html += '<option value="orchestral_harp">Orchestral Harp</option>'
	html += '<option value="overdriven_guitar">Overdriven Guitar</option>'
	html += '<option value="pad_1_new_age">Pad 1 New Age</option>'
	html += '<option value="pad_2_warm">Pad 2 Warm</option>'
	html += '<option value="pad_3_polysynth">Pad 3 Polysynth</option>'
	html += '<option value="pad_4_choir">Pad 4 Choir</option>'
	html += '<option value="pad_5_bowed">Pad 5 Bowed</option>'
	html += '<option value="pad_6_metallic">Pad 6 Metallic</option>'
	html += '<option value="pad_7_halo">Pad 7 Halo</option>'
	html += '<option value="pad_8_sweep">Pad 8 Sweep</option>'
	html += '<option value="pan_flute">Pan Flute</option>'
	html += '<option value="percussive_organ">Percussive Organ</option>'
	html += '<option value="piccolo">Piccolo</option>'
	html += '<option value="pizzicato_strings">Pizzicato Strings</option>'
	html += '<option value="recorder">Recorder</option>'
	html += '<option value="reed_organ">Reed Organ</option>'
	html += '<option value="reverse_cymbal">Reverse Cymbal</option>'
	html += '<option value="rock_organ">Rock Organ</option>'
	html += '<option value="seashore">Seashore</option>'
	html += '<option value="shakuhachi">Shakuhachi</option>'
	html += '<option value="shamisen">Shamisen</option>'
	html += '<option value="shanai">Shanai</option>'
	html += '<option value="sitar">Sitar</option>'
	html += '<option value="slap_bass_1">Slap Bass 1</option>'
	html += '<option value="slap_bass_2">Slap Bass 2</option>'
	html += '<option value="soprano_sax">Soprano Sax</option>'
	html += '<option value="steel_drums">Steel Drums</option>'
	html += '<option value="string_ensemble_1">String Ensemble 1</option>'
	html += '<option value="string_ensemble_2">String Ensemble 2</option>'
	html += '<option value="synth_bass_1">Synth Bass 1</option>'
	html += '<option value="synth_bass_2">Synth Bass 2</option>'
	html += '<option value="synth_drum">Synth Drum</option>'
	html += '<option value="synth_voice">Synth Voice</option>'
	html += '<option value="synthbrass_1">Synthbrass 1</option>'
	html += '<option value="synthbrass_2">Synthbrass 2</option>'
	html += '<option value="synthstrings_1">Synthstrings 1</option>'
	html += '<option value="synthstrings_2">Synthstrings 2</option>'
	html += '<option value="taiko_drum">Taiko Drum</option>'
	html += '<option value="tango_accordion">Tango Accordion</option>'
	html += '<option value="telephone_ring">Telephone Ring</option>'
	html += '<option value="tenor_sax">Tenor Sax</option>'
	html += '<option value="timpani">Timpani</option>'
	html += '<option value="tinkle_bell">Tinkle Bell</option>'
	html += '<option value="tremolo_strings">Tremolo Strings</option>'
	html += '<option value="trombone">Trombone</option>'
	html += '<option value="trumpet">Trumpet</option>'
	html += '<option value="tuba">Tuba</option>'
	html += '<option value="tubular_bells">Tubular Bells</option>'
	html += '<option value="vibraphone">Vibraphone</option>'
	html += '<option value="viola">Viola</option>'
	html += '<option value="violin">Violin</option>'
	html += '<option value="voice_oohs">Voice Oohs</option>'
	html += '<option value="whistle">Whistle</option>'
	html += '<option value="woodblock">Woodblock</option>'
	html += '<option value="xylophone">Xylophone</option>'
	html += '</select>'
	html += '</div>'
	html += '<div class="tool">'
	html += '<select id="keyInput">'
	html += '<option value="" disabled="disabled" selected="selected">Select a key</option>'
	html += '<option value=0>C</option>'
	html += '<option value=1>C#</option>'
	html += '<option value=2>D</option>'
	html += '<option value=3>D#</option>'
	html += '<option value=4>E</option>'
	html += '<option value=5>F</option>'
	html += '<option value=6>F#</option>'
	html += '<option value=7>G</option>'
	html += '<option value=8>G#</option>'
	html += '<option value=9>A</option>'
	html += '<option value=10>A#</option>'
	html += '<option value=11>B</option>'
	html += '</select>'
	html += '</div>'
	html += '<div class="tool">'
	html += '<input type="color" id="colorPicker">'
	html += '</div>'
	html += '</div>'
	html += '<center><div class="tool">'
	html += '<input type="text" id="titleInput" placeholder="Title">'
	html += '</div>'
	html += '<div class="tool">'
	html += '<input type="text" id="authorInput" placeholder="Artist">'
	html += '</div>'
	html += '<div class="tool">'
	html += '<input type="text" id="descInput" placeholder="Description">'
	html += '</div></center>'
	html += '<center><div class="tool">'
	html += '<button type="button" id="saveBtn" onClick="save()">Save</button>'
	html += '</div></center>'
	html += '<center><div class="tool">'
	html += '<button type="button" id="deleteBtn" onClick="back()">Back</button>'
	html += '</div></center>';

	document.getElementsByClassName("content")[0].innerHTML = html;

	document.getElementById("colorPicker").value = currColor;
			// color picker event listener
			document.getElementById("colorPicker").addEventListener("change", function() {
				currColor = document.getElementById("colorPicker").value;
			})

			// tempo input event listener
			document.getElementById("tempoInput").addEventListener("change", function() {
			    beatsPerMin = 6000 / document.getElementById("tempoInput").value; //TODO error checking

			    clearInterval(intervalVar);
			    intervalVar = window.setInterval(highlightCol, beatsPerMin);
			});

			// instrument input event listener
			document.getElementById("instrumentInput").addEventListener("change", function() {
				console.log(document.getElementById("instrumentInput").value);
				loadMIDI(document.getElementById("instrumentInput").value);
			});

			// key input event listener
			document.getElementById("keyInput").addEventListener("change", function() {
				offset = parseInt(document.getElementById("keyInput").value);
			});

			document.getElementById("trexImg").addEventListener("mouseover", function() {
				document.getElementById("trexImg").src = "images/trex3.png";
			});
			document.getElementById("trexImg").addEventListener("mouseout", function() {
				document.getElementById("trexImg").src = "images/trex2.png";
			});

			// title input event listener
			document.getElementById("titleInput").addEventListener("change", function() {
				// save the matrix title
				console.log("new title");
			});

			// author input event listener
			document.getElementById("authorInput").addEventListener("change", function() {
				// save the matrix author
				console.log("new author");
			});

			// description input event listener
			document.getElementById("descInput").addEventListener("change", function() {
				// save the matrix description
				console.log("new description");
			});

		}

		function loadSong(songID) {
			noteArray = songList[songID].matrix;
			height = noteArray.length;
			width = noteArray[0].length;
			loadHTML();
			loadMatrix();
		}

		function likeButton(songID) {

			songList[songID].likes += 1;
			console.log("add like to song: " + songID);

			makePost('/update-rating', '{"name":"' + songList[songID].name + '","artist":"' + songList[songID].artist + '","likes":' + songList[songID].likes + '}');
			refresh();

		}

		function unlikeButton(songID) {

			if(songList[songID].likes > 0) {
				songList[songID].likes -= 1;
				console.log("add like to song: " + songID);

				makePost('/update-rating', '{"name":"' + songList[songID].name + '","artist":"' + songList[songID].artist + '","likes":' + songList[songID].likes + '}');
				refresh();
			}
		}

		function makeGet(url, cb) {
			var req = new XMLHttpRequest();
			req.onreadystatechange = function() { handleRes(req, cb); }
			req.open('GET', url);
			req.send();
		}

		function makePost(url, params) {
			var req = new XMLHttpRequest();
			req.onreadystatechange = function() { console.log('POST complete'); }
			req.open('POST', url);
			req.send(params);
		}

		function handleRes(req, cb) {
			if (req.readyState !== XMLHttpRequest.DONE) {
				return;
			} else if (req.status === 200) {
				if (cb) cb(JSON.parse(req.responseText));
			}
		}

		</script>

</html>

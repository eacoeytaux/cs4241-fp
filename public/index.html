
<!DOCTYPE html>
<html lang="en">
<head>
  <title>CS4241 Final Project</title>
  <meta charset="utf-8">
  <link rel="stylesheet" type="text/css" href="css/style.css"/>
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Arvo">
</head>
<body>
  <div class="header">
    <img id="trexImg" src="images/trex2.png" alt="T-Rex Logo">
    <h1 id="mainHeading">maTRex</h1>
  </div>

  <div class="content">

    <div id="buffer" class="side-panel"></div>

    <div id="matrix" draggable=false>
    </div>

    <div id="tools" class="side-panel">
     <div class="tool">
      Column:
      <button type='button' id="addCol" onClick="addCol()">+</button>
      <button type='button' id="removeCol" onClick="removeCol()">-</button>
    </div>

    <div class="tool">
      Tempo:
      <input type='text' id="tempoInput" placeholder="BPM" value="120">
    </div>

    <div class="tool">
      Key:
      <select>
        <option value="" disabled="disabled" selected="selected">Select a key</option>
        <option value="c">C</option>
        <option value="d">D</option>
      </select>
    </div>

    <div class="tool">
     Color: 
     <input type='color' id="colorPicker">
   </div>
 </div>
</div>

</body>

<script>

// order goes [row][column]
noteArray = [[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]];

var height = 16;
var width = 16;
var currCol = 0;
var currColor = "red";
var beatsPerMin = 100;
var mouseClick = false;
var addColor = false;


// Add event listeners to notes
window.onload = function() {

	loadMatrix();

	
	
	// mouse release event anywhere in the document disables mouse click
	document.addEventListener("mouseup", function(evt) {
		mouseClick = false;
	});
	
	document.addEventListener("mouseup", function(evt) {
		mouseClick = false;
	});

  document.getElementById("colorPicker").addEventListener("change", function() {
    currColor = document.getElementById("colorPicker").value;
  })

  document.getElementById("tempoInput").addEventListener("change", function() {
    beatsPerMin = document.getElementById("tempoInput").value; //TODO error checking

    clearInterval(intervalVar);
    intervalVar = window.setInterval(highlightCol, beatsPerMin);
  });

  document.getElementById("trexImg").addEventListener("mouseover", function() {
    document.getElementById("trexImg").src = "images/trex3.png";
  });
  document.getElementById("trexImg").addEventListener("mouseout", function() {
    document.getElementById("trexImg").src = "images/trex2.png";
  });
}

var intervalVar = window.setInterval(highlightCol, beatsPerMin); // repeat forever, polling every 100 ms


function loadMatrix() {

	el = document.getElementById("matrix");
	html = '<center>'
	
	// Add the correct number of notes to the matrix
	for(var row = 0; row < height; row++) {

		html = html + '<div class="row" draggable=false>';
		for(var col = 0; col < width; col++) {
			html = html + '<div id="' + row + ':' + col +'" class="notes row:' + row + ' col:' + col + '" draggable=false></div>';
		}
		html = html + '</div>';
	}
	el.innerHTML = html + '</center>'
	
	
	for(var row = 0; row < height; row++) {
		for(var col = 0; col < width; col++) {
			if(noteArray[row][col] == 1) {
				document.getElementById(row+ ':' + col).style.backgroundColor = '#F0F0F0';
			}
			else {
				document.getElementById(row+ ':' + col).style.backgroundColor = '#494949';
			}
		}
	}
	
	
	var notes = document.getElementsByClassName("notes");
	for (var i = 0; i < notes.length; i++) {
		notes[i].addEventListener("mousedown", function(evt) {

			// set the mouse click boolean to true
			mouseClick = true;
			// determine the row and column of the clicked noteArray
			var temp = evt.target.className.split(':')
			var row = temp[1].split(' ')[0];
			var col = temp[2];
			if(noteArray[row][col] == 0) {
				evt.target.style.backgroundColor = '#F0F0F0';
				noteArray[row][col] = 1;
				addColor = true;
			}
			else {
				evt.target.style.backgroundColor = '#494949';
				noteArray[row][col] = 0;
				addColor = false;
			}
		});
	}
	
	
	// handle mouse drag events
	for (var i = 0; i < notes.length; i++) {
		notes[i].addEventListener("mouseover", function(evt) {

			// change the note color if a mouse click has already occured
			if(mouseClick) {

				// determine the row and column of the clicked noteArray
				var temp = evt.target.className.split(':')
				var row = temp[1].split(' ')[0];
				var col = temp[2];
				if(addColor) {
					evt.target.style.backgroundColor = '#F0F0F0';
					noteArray[row][col] = 1;
				}
				else {
					evt.target.style.backgroundColor = '#494949';
					noteArray[row][col] = 0;
				}
			}
		});
	}
}
	


function highlightCol() {

	// Make any active cells white again
	var el; 
	for(var row = 0; row < height; row++) {
		if(noteArray[row][currCol]) {
			el = document.getElementById(row+ ':' + currCol)
			el.style.backgroundColor = '#F0F0F0';
		}
	}

	// increment the currCol variable
	if(currCol < (width-1)) {
		currCol += 1;
	}
	else {
		currCol = 0;
	}

	// determine which notes are active
	for(var row = 0; row < height; row++) {
		if(noteArray[row][currCol]) {
			el = document.getElementById(row+ ':' + currCol)
			el.style.backgroundColor = currColor;
		}
	}
}

// add a column to the matrix
function addCol() {
	width += 1;
	loadMatrix();
}

// remove a column from the matrix
function removeCol() {
	if(width > 0) {
		width -= 1;
	}
	loadMatrix();
}


</script>

</html>
